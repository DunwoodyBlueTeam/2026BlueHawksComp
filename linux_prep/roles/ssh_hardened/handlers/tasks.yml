- name: Restart SSH socket
  ansible.builtin.systemd_service:
    name: ssh.socket
    state: restarted
    daemon_reload: true  # runs systemctl daemon-reload before restarting socket, a requirement.

# https://www.cyberciti.biz/tips/checking-openssh-sshd-configuration-syntax-errors.html
- name: Validate SSH config
  ansible.builtin.command: /usr/sbin/sshd -t
  register: command_result
  failed_when: command_result.rc != 0
  notify: Restart SSH

- name: Restart SSH
  ansible.builtin.service:
    name: "{{ (ansible_facts['os_family'] == 'Debian') | ansible.builtin.ternary('ssh', 'sshd') }}"
    state: restarted
